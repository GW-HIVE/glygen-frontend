<!DOCTYPE html>
<html>

<head>

    <style>
        div {
            background-color: #e1e1e1;
            font-family: "Courier New", Courier, monospace;
            font-size: 14px;
            line-height: 30px;
            display: inline-block;
            padding: 15px;
        }


        .ng {
            border-top: 4px solid red;
        }

        .ns {
            text-decoration: underline;
            text-decoration-color: red;
        }

        .og {
            border-top: 4px solid #5577FF;
        }

        .op {
            border-bottom: 4px solid #33FF55;
        }

        .mut {
            background-color: aliceblue;
        }
    </style>


    <script>

        function doIt() {
            var data, x = "";

            // data ultimately read from URL, but here just for testing
            data = {
                "protein": {
                    "name": "fictional",
                    "sequence": "MWVTKLLPALNGSHVLLHLNGTPIAIPYAEGQRKRRNGTIHESKKSNKTTLISIDPALKSKTKSVNTADQCNVCTRNKGLPFTCNGTVFDKARKQCLSFPFNSMSSGVKKEFGHEFDLYN",
                    "annotations": [
                        { "ix": 10, "kind": "N-glycosylated" },
                        { "ix": 19, "kind": "N-glycosylated" },
                        { "ix": 46, "kind": "N-glycosylated" },
                        { "ix": 71, "kind": "N-glycosylated" },
                        { "ix": 84, "kind": "N-sequon" },
                        { "ix": 45, "kind": "O-glycosylated" },
                        { "ix": 52, "kind": "O-glycosylated" },
                        { "ix": 59, "kind": "O-glycosylated" },
                        { "ix": 59, "kind": "O-phosphorylated" },
                        { "ix": 63, "kind": "O-glycosylated" },
                        { "ix": 97, "kind": "O-glycosylated" },
                        { "ix": 45, "kind": "O-phosphorylated" },
                        { "ix": 45, "kind": "mutated" },
                        { "ix": 84, "kind": "mutated" },
                        { "ix": 85, "kind": "mutated" }
                    ]
                }
            }
            var s = data.protein.sequence;
            var a = data.protein.annotations
            var seq = new Array(); // array of sequon character indices

            // find N-sequons in sequence s and put character indices into array seq
            for (var i = 0; i < s.length - 2; i++) {
                var seq3 = s.substr(i, 3);
                var p = new RegExp("N[A-Z][ST]");
                if (p.test(seq3)) { // sequon found in the 3-character substring
                    // alert("found " + seq3 + " at " + i);
                    seq.push(i);
                }
            }

            var sequonChar = 1;

            // check for annotations and add css styles appropriately
            for (var i = 0; i < s.length; i++) {
                y = s.charAt(i);
                if ((i % 10) == 0) x += " ";  // decade breaks
                if (((i % 60) == 0) && (i != 0)) x += "<br>"; // line breaks
                var j;
                var v = "";
                var v1 = "";
                var v2 = "";
                var foundAnnotation = false;
                sequonChar--;

                for (var j = 0; j < seq.length; j++) {
                    if (i == seq[j]) sequonChar = 3;
                }


                if (sequonChar > 0) {
                    foundAnnotation = true;
                    v += "ns ";
                }

                // check data for amino acid annotations (in array a)
                for (j = 0; j < a.length; j++) {
                    if (a[j].ix == i) {
                        k = a[j].kind;
                        switch (k) {
                            case "N-glycosylated":
                                v += "ng ";
                                foundAnnotation = true;
                                break;
                            /* case "N-sequon":
                                 v += "ns ";
                                 foundAnnotation = true;
                                 break;
                             */
                            case "O-glycosylated":
                                v += "og ";
                                foundAnnotation = true;
                                break;
                            case "O-phosphorylated":
                                v += "op ";
                                foundAnnotation = true;
                                break;
                            case "mutated":
                                v += "mut ";
                                foundAnnotation = true;
                                break;
                        }
                    }
                }
                if (foundAnnotation == true) {
                    // alert("found annotation: i is " + i + " AA is " + y + " style is " + v);
                    v1 = "<char class='" + v + "'>";
                    v2 = "</char>";
                }
                x += v1 + y + v2;
            }
            x += "<br>";

            document.getElementById("sequence").innerHTML = x;

        } // end doIt() method

    </script>



</head>


<body onload="doIt()">

    <h2>Modify only the css to evaluate different amino acid highlighting schemes</h2>

    <p>
        <char class="ng">N-glycosylated</char>&nbsp;&nbsp;
        <char class="ns">N-sequon</char>&nbsp;&nbsp;
        <char class="og">O-glycosylated</char>&nbsp;&nbsp;
        <char class="op">O-phosphorylated</char>&nbsp;&nbsp;
        <char class="mut">mutated</char>
    </p>

    <div id="sequence"></div>

    <p>This uses regular expressions to find N-glycosylation sequons</p>





</body>

</html>