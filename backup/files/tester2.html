<!DOCTYPE html>
<html>
    
<head>
    
<title>Evaluate Highlight Scheme</title>
    
<style>

div {
    background-color: #e1e1e1;
    font-family: "Courier New", Courier, monospace;
    font-size: 10px;
    line-height: 30px;
    display: inline-block;
    padding: 15px;
}
    
.r {
    text-align:right;
}  
    
.ng {
}
 
.ns {
}
    
.og {
}
    
.op {
}
    
.mut {
}
    
</style>
    
    
<script>
    
function doIt() {
 var data, x = "<center><b>Key</b><center>" +
    "<span class=\"ng\">N-glycosylated</span>&nbsp;" +
    "<span class=\"ns\">N-sequon</span>&nbsp;" +
    "<span class=\"og\">O-glycosylated</span>&nbsp;" +
    "<span class=\"op\">O-phosphorylated</span>&nbsp;" +
    "<span class=\"mut\">mutated</span>" +
    "<center><b>Sequence</b><center>&nbsp;";

 // data ultimately read from URL, but here just for testing
 data = {
  "protein": {
    "name": "fictional",
    "sequence": "MWVTKLLPALNGSHVLLHLNGTPIAIPYAEGQRKRRNGTIHESKKSNKTTLISIDPALKSKTKSVNTADQCNVCTRNKGLPFTCNGTVFDKARKQCLSFPFNPTSSGVKKEFGHEFDLYN",
    "annotations" : [
        {"ix": 10, "kind": "N-glycosylated"},
        {"ix": 19, "kind": "N-glycosylated"},
        {"ix": 46, "kind": "N-glycosylated"},
        {"ix": 71, "kind": "N-glycosylated"},
        {"ix": 84, "kind": "N-sequon"},
        {"ix": 45, "kind": "O-glycosylated"}, 
        {"ix": 52, "kind": "O-glycosylated"}, 
        {"ix": 59, "kind": "O-glycosylated"}, 
        {"ix": 59, "kind": "O-phosphorylated"}, 
        {"ix": 63, "kind": "O-glycosylated"}, 
        {"ix": 97, "kind": "O-glycosylated"}, 
        {"ix": 45, "kind": "O-phosphorylated"},
        {"ix": 45, "kind": "mutated"},
        {"ix": 84, "kind": "mutated"},
        {"ix": 85, "kind": "mutated"}
    ]
  }
 }
 var s = data.protein.sequence;
 var a = data.protein.annotations
 var seq = new Array(); // array of sequon character indices
    
 // find N-sequons in sequence s and put character indices into array seq
 for (var i = 0; i < s.length - 2; i++) {
    var seq3 = s.substr(i, 3);
    var p = new RegExp("N[^P][CST]");
    if (p.test(seq3)) { // sequon found in the 3-character substring
        // alert("found " + seq3 + " at " + i);
        seq.push(i);
    }
 }
    
 var sequonChar = 1;

 // check for annotations and add css styles appropriately
 for (var i = 0; i < s.length; i++) {
    y = s.charAt(i);
    if (((i % 10) == 0) && (i != 0)) x += "&nbsp;";  // decade breaks
    if (((i % 60) == 0) && (i != 0)) x += "<br>"; // line breaks
    var j;
    var v = "";
    var v1 = "";
    var v2 = "";
    var foundAnnotation = false;
    sequonChar--;
    
    for (var j = 0; j < seq.length; j++) {
        if(i == seq[j]) sequonChar = 3;
    }


    if (sequonChar > 0) {
        foundAnnotation = true;
        v += "ns ";
    }
    
    // check data for amino acid annotations (in array a)
    for (j = 0; j < a.length; j++) {
        if (a[j].ix == i) {
            k = a[j].kind;
            switch(k) {
                case "N-glycosylated":
                    v += "ng ";
                    foundAnnotation = true;
                    break;
               /* case "N-sequon": // this is done locally using regex
                    v += "ns ";
                    foundAnnotation = true;
                    break;
                */
                case "O-glycosylated":
                    v += "og ";
                    foundAnnotation = true;
                    break;
                case "O-phosphorylated":
                    v += "op ";
                    foundAnnotation = true;
                    break;
                case "mutated":
                    v += "mut ";
                    foundAnnotation = true;
                    break;
            }
        }
    }
    if (foundAnnotation == true) {
        // alert("found annotation: i is " + i + " AA is " + y + " style is " + v);
        v1 = "<span class='" + v + "'>";
        v2 = "</span>";
    }
    x += v1 + y + v2;
 }
 x += "<br>";

 document.getElementById("sequence").innerHTML = x;
    
} // end doIt() method
    
function clearHighlights(elem) {
        elem.style.backgroundColor="";
        elem.style.borderTopStyle="none";  
        elem.style.borderBottomStyle="none";
        elem.style.textDecoration="none";
        elem.style.color="black";
        elem.style.fontWeight="normal";
        elem.style.fontStyle="normal";
        
}
    
function setHighlights(elem, bac, tc, bc, uc, txc, bd, it) {
    // alert(bac + " " + tc + " " + bc + " " + uc + " " + txc + " " + b)
        if (bac != "") {
            elem.style.backgroundColor=bac;
        }
    
        if (tc != "") {
            elem.style.borderTopStyle="solid";
            elem.style.borderTopColor=tc;
        }
    
        if (bc != "") {
            elem.style.borderBottomStyle="solid";
            elem.style.borderBottomColor=bc;
        }
    
        if (uc != "") {
            elem.style.textDecoration="underline";
            elem.style.textDecorationColor=uc;
        }    
 
        if (txc != "") {
            elem.style.color=txc;
        }
    
        if (bd == true) {
            elem.style.fontWeight="bold";
        }
 
        if (it == true) {
            elem.style.fontStyle="italic";
        }
 
}
    
    
var which = ["ng", "ns", "og", "op", "mut"];
    
function chng() {
    for (var j = 0; j < which.length; j++) {
        var elements = document.getElementsByClassName(which[j]);
        for(var i = 0; i < elements.length; i++) {
            clearHighlights(elements[i]);
        }
    }
    
    for (var j = 0; j < which.length; j++) {
        var back = document.getElementById("background_" + j).value;
        var top = document.getElementById("top_" + j).value;
        var bottom = document.getElementById("bottom_" + j).value;
        var under = document.getElementById("underline_" + j).value;
        var textColor = document.getElementById("text_color_" + j).value;
        var boldOn = document.getElementById("bold_" + j).checked;
        var italicOn = document.getElementById("italic_" + j).checked;
// alert(j + " " + boldOn);
        var elements = document.getElementsByClassName(which[j]); 
// alert(back + "; " + top + "; " + bottom + "; " + under + "; " + textColor + "; " + bold);
        for(var i = 0; i < elements.length; i++) {
            setHighlights(elements[i], back, top, bottom, under, textColor, boldOn, italicOn);
        }
    }
}
    
</script>

 
    
</head>
    
    
<body  onload="doIt()">
    
<h2>Implementation of css editing methods to evaluate different amino acid highlighting schemes</h2>

<div id="sequence"></div>
<br>
   
<h3>Enter the color for each annotation rendering</h3>
These <i><b>generalized</b></i> mappings correspond to the css styles in a javascript array (called "which") that is defined within the onLoad method.<br>
<i>In this case</i>, classes 1-5 are mapped to five distinct styles I am using to highlight amino acids in a sequence ...
    
<xmp>var which = ["ng", "ns", "og", "op", "mut"];</xmp>
    
The types of objects that are highlighted are shown <b>in order</b> in the <b>Key</b> above the sequence

<table>
    <tr>
        <th></th>
        <th>Background</th>
        <th>Top Border</th>
        <th>Bottom Border</th>
        <th>Underline</th>
        <th>Text Color</th>
        <th> Bold Text </th>
        <th>&nbsp;Italic Text&nbsp;</th>
    </tr><tr>
        <th>Class 0</th>
        <td><input type="text" id="background_0"/ value="" onchange="chng();"></td>
        <td><input type="text" id="top_0"/ value="" onchange="chng();"></td>
        <td><input type="text" id="bottom_0"/value="" onchange="chng();"></td>
        <td><input type="text" id="underline_0"/ value="" onchange="chng();"></td>
        <td><input type="text" id="text_color_0"/ value="" onchange="chng();"></td>
        <td align="center"><input type="checkbox" id="bold_0" onchange="chng();"/></td>
        <td align="center"><input type="checkbox" id="italic_0" onchange="chng();"/></td>
    </tr><tr>
        <th>Class 1</th>
        <td><input type="text" id="background_1"/ value="" onchange="chng();"></td>
        <td><input type="text" id="top_1"/ value="" onchange="chng();"></td>
        <td><input type="text" id="bottom_1"/value="" onchange="chng();"></td>
        <td><input type="text" id="underline_1"/ value="" onchange="chng();"></td>
        <td><input type="text" id="text_color_1"/ value="" onchange="chng();"></td>
        <td align="center"><input type="checkbox" id="bold_1" onchange="chng();"/></td>
        <td align="center"><input type="checkbox" id="italic_1" onchange="chng();"/></td>
    </tr><tr>
        <th>Class 2</th>
        <td><input type="text" id="background_2"/ value="" onchange="chng();"></td>
        <td><input type="text" id="top_2"/ value="" onchange="chng();"></td>
        <td><input type="text" id="bottom_2"/value="" onchange="chng();"></td>
        <td><input type="text" id="underline_2"/ value="" onchange="chng();"></td>
        <td><input type="text" id="text_color_2"/ value="" onchange="chng();"></td>
        <td align="center"><input type="checkbox" id="bold_2" onchange="chng();"/></td>
         <td align="center"><input type="checkbox" id="italic_2" onchange="chng();"/></td>
   </tr><tr>
        <th>Class 3</th>
        <td><input type="text" id="background_3"/ value="" onchange="chng();"></td>
        <td><input type="text" id="top_3"/ value="" onchange="chng();"></td>
        <td><input type="text" id="bottom_3"/value="" onchange="chng();"></td>
        <td><input type="text" id="underline_3"/ value="" onchange="chng();"></td>
        <td><input type="text" id="text_color_3"/ value="" onchange="chng();"></td>
        <td align="center"><input type="checkbox" id="bold_3" onchange="chng();"/></td>
        <td align="center"><input type="checkbox" id="italic_3" onchange="chng();"/></td>
    </tr><tr>
        <th>Class 4</th>
        <td><input type="text" id="background_4"/ value="" onchange="chng();"></td>
        <td><input type="text" id="top_4"/ value="" onchange="chng();"></td>
        <td><input type="text" id="bottom_4"/value="" onchange="chng();"></td>
        <td><input type="text" id="underline_4"/ value="" onchange="chng();"></td>
        <td><input type="text" id="text_color_4"/ value="" onchange="chng();"></td>
        <td align="center"><input type="checkbox" id="bold_4" onchange="chng();"/></td>
        <td align="center"><input type="checkbox" id="italic_4" onchange="chng();"/></td>
    </tr><tr style="color:lightgray">
        <th>Class 5</th>
        <td><input type="text" id="background_5"/ value="" onchange="chng();"></td>
        <td><input type="text" id="top_5"/ value="" onchange="chng();"></td>
        <td><input type="text" id="bottom_5"/value="" onchange="chng();"></td>
        <td><input type="text" id="underline_5"/ value="" onchange="chng();"></td>
        <td><input type="text" id="text_color_5"/ value="" onchange="chng();"></td>
        <td align="center"><input type="checkbox" id="bold_5" onchange="chng();"/></td>
        <td align="center"><input type="checkbox" id="italic_45" onchange="chng();"/></td>
    </tr>
</table>


    
<p></p>
    
<p>This uses regular expressions to find N-glycosylation sequons</p>
<p>Serine 45 is O-glycosylated, O-phosphorylated and mutated!</p>



    

</body>
</html>
